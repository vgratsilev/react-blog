"use strict";(self.webpackChunkreact_blog=self.webpackChunkreact_blog||[]).push([[36],{634:function(e,t,a){a.d(t,{s:function(){return r},y:function(){return i}});const s=(0,a(4268).oM)({name:"addCommentForm",initialState:{text:"",error:""},reducers:{setText:(e,t)=>{e.text=t.payload}}}),{actions:i}=s,{reducer:r}=s},4941:function(e,t,a){a.r(t),a.d(t,{default:function(){return K}});var s=a(7090),i=a(5443),r=a(7294),n=a(1913),c=a(9250),l=a(4839),d=a(8498),o=a(157),m=a(6276);const h=a(7945).p.injectEndpoints({endpoints:e=>({getArticleRecommendationsList:e.query({query:e=>({url:"/articles",params:{_limit:e}})})})}),{useGetArticleRecommendationsListQuery:x}=h;var g=a(5893);const u=(0,r.memo)((e=>{const{className:t}=e,{t:a}=(0,i.$)("article"),{data:r,isLoading:c,error:l}=x(3);return c||l||!r?null:(0,g.jsxs)(o.g,{gap:"8",maxWidth:!0,className:(0,s.A)("",{},[t]),children:[(0,g.jsx)(m.xv,{size:m.yH.L,title:a("RecommendationsBlockTitle"),TitleTag:"h2"}),(0,g.jsx)(n.wD,{articles:r,view:n.GA.TILE,target:"_blank"})]})}));var j=a(7795);const p=(0,r.lazy)((()=>a.e(225).then(a.bind(a,3225)).then((e=>({default:e.ArticleRating}))))),N=e=>(0,g.jsx)(r.Suspense,{fallback:(0,g.jsx)(j.O,{width:"100%",height:120}),children:(0,g.jsx)(p,{...e})});a(634);const f=(0,r.lazy)((()=>a.e(674).then(a.bind(a,7674)).then((e=>({default:e.AddCommentForm})))));var v=a(42),A=a(6522),C=a(2610),L={commentCard:"ghhhlnG6",header:"dsH_3Oqu",username:"dw82WMzO",loading:"V0iZ1Un3"};const w=(0,r.memo)((e=>{const{className:t,comment:a,isLoading:i}=e;return i?(0,g.jsxs)(o.g,{gap:"8",maxWidth:!0,className:(0,s.A)(L.commentCard,{},[t,L.loading]),children:[(0,g.jsxs)("div",{className:L.header,children:[(0,g.jsx)(j.O,{width:30,height:30,borderRadius:"50%"}),(0,g.jsx)(j.O,{width:100,height:16,className:L.username})]}),(0,g.jsx)(j.O,{width:"100%",height:50,className:L.text})]}):a?(0,g.jsxs)(o.g,{maxWidth:!0,gap:"8",className:(0,s.A)(L.commentCard,{},[t]),children:[(0,g.jsxs)(A.F,{to:`${C.h.profile}${a.user.id}`,className:L.header,children:[(0,g.jsx)(v.q,{size:30,src:a.user.avatar}),(0,g.jsx)(m.xv,{className:L.username,text:a.user.username})]}),(0,g.jsx)(m.xv,{className:L.text,text:a.text})]}):null})),y=(0,r.memo)((e=>{const{className:t,comments:a,isLoading:r}=e,{t:n}=(0,i.$)();return r?(0,g.jsxs)(o.g,{gap:"16",maxWidth:!0,className:(0,s.A)("",{},[t]),children:[(0,g.jsx)(w,{isLoading:!0}),(0,g.jsx)(w,{isLoading:!0}),(0,g.jsx)(w,{isLoading:!0})]}):(0,g.jsx)(o.g,{gap:"16",maxWidth:!0,className:(0,s.A)("",{},[t]),children:a?.length?a.map((e=>(0,g.jsx)(w,{isLoading:r,comment:e},e.id))):(0,g.jsx)(m.xv,{text:n("NoCommentsMessage")})})}));var b=a(1992),k=a(2647),I=a(3562),S=a(349),D=a(4268);const T=(0,D.hg)("articleDetails/fetchCommentsByArticleId",(async(e,t)=>{const{rejectWithValue:a,extra:s}=t;if(!e)return a("error");try{const t=await s.api.get("/comments",{params:{articleId:e,_expand:"user"}});if(!t.data)throw new Error;return t.data}catch(e){return a("error")}})),W=(0,D.HF)({selectId:e=>e.id}),O=W.getSelectors((e=>e.articleDetailsPage?.comments||W.getInitialState())),E=(0,D.oM)({name:"articleDetailsCommentSlice",initialState:W.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(T.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(T.fulfilled,((e,t)=>{e.isLoading=!1,W.setAll(e,t.payload)})).addCase(T.rejected,((e,t)=>{e.isLoading=!1,e.error=t.payload}))}}),{reducer:P}=E,R=e=>e.articleDetailsPage?.comments?.isLoading||!1;var $=a(5625);const z=(0,D.hg)("articleDetails/addCommentForArticle",(async(e,t)=>{const{dispatch:a,rejectWithValue:s,extra:i,getState:r}=t,c=(0,$.m5)(r()),l=(0,n.wq)(r());if(!c||!e||!l)return s("No data");try{const t=await i.api.post("/comments",{articleId:l.id,userId:c.id,text:e});if(!t.data)throw new Error("no response");return a(T(l.id)),t.data}catch(e){return s("Add Comment error")}})),_=(0,r.memo)((e=>{const{className:t,id:a}=e,{t:n}=(0,i.$)("article"),c=(0,k.T)(),l=(0,b.v9)(O.selectAll),d=(0,b.v9)(R);(0,I.Q)((()=>{c(T(a))}));const h=(0,r.useCallback)((e=>{c(z(e))}),[c]);return(0,g.jsxs)(o.g,{gap:"8",maxWidth:!0,className:(0,s.A)("",{},[t]),children:[(0,g.jsx)(m.xv,{size:m.yH.L,title:n("CommentsBlockTitle"),TitleTag:"h2"}),(0,g.jsx)(r.Suspense,{fallback:(0,g.jsx)(S.a,{}),children:(0,g.jsx)(f,{onSendComment:h})}),(0,g.jsx)(y,{comments:l,isLoading:d})]})}));var q={articleDetailsPage:"aYtrO4Ii",commentTitle:"foyEsCeG",recommendations:"NwQlSikL"},F=a(3828);const B=(0,D.hg)("articlesDetailsPage/fetchArticleRecommendations",(async(e,t)=>{const{rejectWithValue:a,extra:s}=t;try{const e=await s.api.get("/articles",{params:{_limit:4}});if(!e.data)throw new Error;return e.data}catch(e){return a("error")}})),U=(0,D.HF)({selectId:e=>e.id}),H=(U.getSelectors((e=>e.articleDetailsPage?.recommendations||U.getInitialState())),(0,D.oM)({name:"articleDetailsRecommendationsSlice",initialState:U.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(B.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(B.fulfilled,((e,t)=>{e.isLoading=!1,U.setAll(e,t.payload)})).addCase(B.rejected,((e,t)=>{e.isLoading=!1,e.error=t.payload}))}})),{reducer:M}=H,G=(0,F.UY)({comments:P,recommendations:M});var V=a(2790);const Q=(0,a(2222).P1)(n.wq,$.m5,((e,t)=>!(!e||!t)&&e.user.id===t.id)),Y=(0,r.memo)((e=>{const{className:t}=e,{t:a}=(0,i.$)("article"),l=(0,c.s0)(),d=(0,b.v9)(n.wq),m=(0,b.v9)(Q),h=(0,r.useCallback)((()=>{l(C.h.articles)}),[l]),x=(0,r.useCallback)((()=>{l(`${C.h.article_details}${d?.id}/edit`)}),[d?.id,l]);return(0,g.jsxs)(o.U,{maxWidth:!0,justify:"between",className:(0,s.A)("",{},[t]),children:[(0,g.jsx)(V.zx,{theme:V.bn.OUTLINE,onClick:h,children:a("BackToArticleListBtn")}),m&&(0,g.jsx)(V.zx,{theme:V.bn.OUTLINE,onClick:x,children:a("EditArticleBtn")})]})})),Z={articleDetailsPage:G},J=e=>{const{className:t,testId:a}=e,{t:r}=(0,i.$)("article");let{id:m}=(0,c.UO)();return m?(0,g.jsx)(l.W,{reducers:Z,children:(0,g.jsx)(d.T,{className:(0,s.A)(q.ArticleDetailsPage,{},[t]),children:(0,g.jsxs)(o.g,{maxWidth:!0,gap:"16",children:[(0,g.jsx)(Y,{}),(0,g.jsx)(n.D0,{id:m}),(0,g.jsx)(N,{articleId:m}),(0,g.jsx)(u,{}),(0,g.jsx)(_,{id:m})]})})}):(0,g.jsx)("div",{className:(0,s.A)(q.ArticleDetailsPage,{},[t]),children:r("ArticleNotFound")})};var K=(0,r.memo)(J)}}]);